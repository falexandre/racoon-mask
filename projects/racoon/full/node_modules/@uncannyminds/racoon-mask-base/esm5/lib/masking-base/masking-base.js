/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
var MaskingBase = /** @class */ (function () {
    function MaskingBase() {
        this._slotChar = "_";
        this._showPlaceholder = false;
        this._mask = "";
    }
    /**
     * @private
     * @param {?} s
     * @return {?}
     */
    MaskingBase.isNumeric = /**
     * @private
     * @param {?} s
     * @return {?}
     */
    function (s) {
        if (s === " ") {
            return false;
        }
        return !isNaN(Number(s));
    };
    /**
     * @private
     * @param {?} s
     * @return {?}
     */
    MaskingBase.isAlpha = /**
     * @private
     * @param {?} s
     * @return {?}
     */
    function (s) {
        return s.match(/^[a-z]+$/i) !== null;
    };
    /**
     * @return {?}
     */
    MaskingBase.prototype.checkValue = /**
     * @return {?}
     */
    function () {
        this.oldValue = this.value;
        this.value = this._input.nativeElement.value;
        if (!this.value) {
            return;
        }
        this.maskValue();
    };
    /**
     * @return {?}
     */
    MaskingBase.prototype.maskValue = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var maskedValue = "";
        /** @type {?} */
        var dif = 0;
        /** @type {?} */
        var foundPlaceholder = false;
        for (var i = 0; i < this._mask.length && this.value.length !== i; i++) {
            /** @type {?} */
            var maskChar = this._mask.charAt(i + dif);
            /** @type {?} */
            var valueChar = this.value.charAt(i);
            if (this._showPlaceholder && valueChar === this._slotChar) {
                if (foundPlaceholder) {
                    break;
                }
                foundPlaceholder = true;
            }
            if (!MaskingBase.isAlpha(valueChar)
                && !MaskingBase.isNumeric(valueChar)
                && valueChar !== maskChar) {
                this.value = this.value.substring(0, i) + this.value.substring(i + 1);
                i--;
            }
            else if (maskChar === "9") {
                if (MaskingBase.isNumeric(valueChar)) {
                    maskedValue += valueChar;
                }
                else {
                    this.value = this.value.substring(0, i) + this.value.substring(i + 1);
                    i--;
                }
            }
            else if (maskChar === "A") {
                if (MaskingBase.isAlpha(this.value.charAt(i))) {
                    maskedValue += valueChar;
                }
                else {
                    this.value = this.value.substring(0, i) + this.value.substring(i + 1);
                    i--;
                }
            }
            else if (maskChar !== valueChar && maskedValue.charAt(i + dif) !== maskChar) {
                maskedValue += maskChar;
                dif++;
                i--;
            }
            else {
                maskedValue += maskChar;
            }
        }
        this.oldLength = maskedValue.length;
        if (this._showPlaceholder) {
            maskedValue = this.fillWithPlaceholder(maskedValue);
            this.oldValue = this.fillWithPlaceholder(this.oldValue);
        }
        this.caretPos = this.getUpdatedCaretPos(maskedValue);
        this.value = maskedValue;
        this.updateInput();
    };
    /**
     * @return {?}
     */
    MaskingBase.prototype.updateInput = /**
     * @return {?}
     */
    function () {
        this._input.nativeElement.value = this.value;
        this._input.nativeElement.selectionStart = this.caretPos;
        this._input.nativeElement.selectionEnd = this.caretPos;
    };
    /**
     * @private
     * @param {?} maskedValue
     * @return {?}
     */
    MaskingBase.prototype.getUpdatedCaretPos = /**
     * @private
     * @param {?} maskedValue
     * @return {?}
     */
    function (maskedValue) {
        /** @type {?} */
        var caretPos = this.getCaretPos();
        if (caretPos === this._input.nativeElement.value.length || caretPos === this.oldLength) {
            caretPos = this.oldLength;
        }
        else if (this.oldValue !== maskedValue) {
            while (caretPos < this.value.length &&
                this._mask.charAt(caretPos) !== "9" &&
                this._mask.charAt(caretPos) !== "A") {
                caretPos++;
            }
        }
        else {
            caretPos--;
        }
        return caretPos;
    };
    /**
     * @private
     * @param {?} value
     * @return {?}
     */
    MaskingBase.prototype.fillWithPlaceholder = /**
     * @private
     * @param {?} value
     * @return {?}
     */
    function (value) {
        if (!value) {
            return value;
        }
        /** @type {?} */
        var mask = this._mask.replace(/[9A]/g, this._slotChar);
        mask = mask.substring(value.length, mask.length);
        value = value + mask;
        return value;
    };
    /**
     * @return {?}
     */
    MaskingBase.prototype.getCaretPos = /**
     * @return {?}
     */
    function () {
        return this._input.nativeElement.selectionStart;
    };
    return MaskingBase;
}());
export { MaskingBase };
if (false) {
    /**
     * @type {?}
     * @private
     */
    MaskingBase.prototype.oldLength;
    /** @type {?} */
    MaskingBase.prototype._slotChar;
    /** @type {?} */
    MaskingBase.prototype._showPlaceholder;
    /** @type {?} */
    MaskingBase.prototype._mask;
    /** @type {?} */
    MaskingBase.prototype._input;
    /**
     * @type {?}
     * @private
     */
    MaskingBase.prototype.oldValue;
    /**
     * @type {?}
     * @private
     */
    MaskingBase.prototype.caretPos;
    /** @type {?} */
    MaskingBase.prototype.value;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFza2luZy1iYXNlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQHVuY2FubnltaW5kcy9yYWNvb24tbWFzay1iYXNlLyIsInNvdXJjZXMiOlsibGliL21hc2tpbmctYmFzZS9tYXNraW5nLWJhc2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUVBO0lBQUE7UUFHVyxjQUFTLEdBQUcsR0FBRyxDQUFDO1FBRWhCLHFCQUFnQixHQUFHLEtBQUssQ0FBQztRQUV6QixVQUFLLEdBQUcsRUFBRSxDQUFDO0lBdUh0QixDQUFDOzs7Ozs7SUE3R2tCLHFCQUFTOzs7OztJQUF4QixVQUF5QixDQUFTO1FBQzlCLElBQUksQ0FBQyxLQUFLLEdBQUcsRUFBRTtZQUNYLE9BQU8sS0FBSyxDQUFDO1NBQ2hCO1FBQ0QsT0FBTyxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUM3QixDQUFDOzs7Ozs7SUFFYyxtQkFBTzs7Ozs7SUFBdEIsVUFBdUIsQ0FBUztRQUM1QixPQUFPLENBQUMsQ0FBQyxLQUFLLENBQUMsV0FBVyxDQUFDLEtBQUssSUFBSSxDQUFDO0lBQ3pDLENBQUM7Ozs7SUFHTSxnQ0FBVTs7O0lBQWpCO1FBQ0ksSUFBSSxDQUFDLFFBQVEsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDO1FBQzNCLElBQUksQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxhQUFhLENBQUMsS0FBSyxDQUFDO1FBQzdDLElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxFQUFFO1lBQ2IsT0FBTztTQUNWO1FBQ0QsSUFBSSxDQUFDLFNBQVMsRUFBRSxDQUFDO0lBQ3JCLENBQUM7Ozs7SUFHTSwrQkFBUzs7O0lBQWhCOztZQUNRLFdBQVcsR0FBRyxFQUFFOztZQUNoQixHQUFHLEdBQUcsQ0FBQzs7WUFDUCxnQkFBZ0IsR0FBRyxLQUFLO1FBRTVCLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxJQUFJLENBQUMs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SUFBSSxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLE1BQU0sRUFBRSxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDakQsS0FBSyxHQUFHLEtBQUssR0FBRyxJQUFJLENBQUM7UUFDckIsT0FBTyxLQUFLLENBQUM7SUFDakIsQ0FBQzs7OztJQUVNLGlDQUFXOzs7SUFBbEI7UUFDSSxPQUFPLElBQUksQ0FBQyxNQUFNLENBQUMsYUFBYSxDQUFDLGNBQWMsQ0FBQztJQUNwRCxDQUFDO0lBQ0wsa0JBQUM7QUFBRCxDQUFDLEFBOUhELElBOEhDOzs7Ozs7O0lBN0hHLGdDQUEwQjs7SUFFMUIsZ0NBQXVCOztJQUV2Qix1Q0FBZ0M7O0lBRWhDLDRCQUFrQjs7SUFFbEIsNkJBQTBCOzs7OztJQUUxQiwrQkFBeUI7Ozs7O0lBRXpCLCtCQUF5Qjs7SUFFekIsNEJBQXFCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRWxlbWVudFJlZiB9IGZyb20gXCJAYW5ndWxhci9jb3JlXCI7XHJcblxyXG5leHBvcnQgY2xhc3MgTWFza2luZ0Jhc2Uge1xyXG4gICAgcHJpdmF0ZSBvbGRMZW5ndGg6IG51bWJlcjtcclxuXHJcbiAgICBwdWJsaWMgX3Nsb3RDaGFyID0gXCJfXCI7XHJcblxyXG4gICAgcHVibGljIF9zaG93UGxhY2Vob2xkZXIgPSBmYWxzZTtcclxuXHJcbiAgICBwdWJsaWMgX21hc2sgPSBcIlwiO1xyXG5cclxuICAgIHB1YmxpYyBfaW5wdXQ6IEVsZW1lbnRSZWY7XHJcblxyXG4gICAgcHJpdmF0ZSBvbGRWYWx1ZTogc3RyaW5nO1xyXG5cclxuICAgIHByaXZhdGUgY2FyZXRQb3M6IG51bWJlcjtcclxuXHJcbiAgICBwdWJsaWMgdmFsdWU6IHN0cmluZztcclxuXHJcbiAgICBwcml2YXRlIHN0YXRpYyBpc051bWVyaWMoczogc3RyaW5nKSB7XHJcbiAgICAgICAgaWYgKHMgPT09IFwiIFwiKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuICFpc05hTihOdW1iZXIocykpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgc3RhdGljIGlzQWxwaGEoczogc3RyaW5nKSB7XHJcbiAgICAgICAgcmV0dXJuIHMubWF0Y2goL15bYS16XSskL2kpICE9PSBudWxsO1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICBwdWJsaWMgY2hlY2tWYWx1ZSgpIHtcclxuICAgICAgICB0aGlzLm9sZFZhbHVlID0gdGhpcy52YWx1ZTtcclxuICAgICAgICB0aGlzLnZhbHVlID0gdGhpcy5faW5wdXQubmF0aXZlRWxlbWVudC52YWx1ZTtcclxuICAgICAgICBpZiAoIXRoaXMudmFsdWUpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLm1hc2tWYWx1ZSgpO1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICBwdWJsaWMgbWFza1ZhbHVlKCkge1xyXG4gICAgICAgIGxldCBtYXNrZWRWYWx1ZSA9IFwiXCI7XHJcbiAgICAgICAgbGV0IGRpZiA9IDA7XHJcbiAgICAgICAgbGV0IGZvdW5kUGxhY2Vob2xkZXIgPSBmYWxzZTtcclxuXHJcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLl9tYXNrLmxlbmd0aCAmJiB0aGlzLnZhbHVlLmxlbmd0aCAhPT0gaTsgaSsrKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IG1hc2tDaGFyID0gdGhpcy5fbWFzay5jaGFyQXQoaSArIGRpZik7XHJcbiAgICAgICAgICAgIGNvbnN0IHZhbHVlQ2hhciA9IHRoaXMudmFsdWUuY2hhckF0KGkpO1xyXG4gICAgICAgICAgICBpZiAodGhpcy5fc2hvd1BsYWNlaG9sZGVyICYmIHZhbHVlQ2hhciA9PT0gdGhpcy5fc2xvdENoYXIpIHtcclxuICAgICAgICAgICAgICAgIGlmIChmb3VuZFBsYWNlaG9sZGVyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBmb3VuZFBsYWNlaG9sZGVyID0gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoIU1hc2tpbmdCYXNlLmlzQWxwaGEodmFsdWVDaGFyKVxyXG4gICAgICAgICAgICAgICAgJiYgIU1hc2tpbmdCYXNlLmlzTnVtZXJpYyh2YWx1ZUNoYXIpXHJcbiAgICAgICAgICAgICAgICAmJiB2YWx1ZUNoYXIgIT09IG1hc2tDaGFyKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnZhbHVlID0gdGhpcy52YWx1ZS5zdWJzdHJpbmcoMCwgaSkgKyB0aGlzLnZhbHVlLnN1YnN0cmluZyhpICsgMSk7XHJcbiAgICAgICAgICAgICAgICBpLS07XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAobWFza0NoYXIgPT09IFwiOVwiKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoTWFza2luZ0Jhc2UuaXNOdW1lcmljKHZhbHVlQ2hhcikpIHtcclxuICAgICAgICAgICAgICAgICAgICBtYXNrZWRWYWx1ZSArPSB2YWx1ZUNoYXI7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMudmFsdWUgPSB0aGlzLnZhbHVlLnN1YnN0cmluZygwLCBpKSArIHRoaXMudmFsdWUuc3Vic3RyaW5nKGkgKyAxKTtcclxuICAgICAgICAgICAgICAgICAgICBpLS07XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAobWFza0NoYXIgPT09IFwiQVwiKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoTWFza2luZ0Jhc2UuaXNBbHBoYSh0aGlzLnZhbHVlLmNoYXJBdChpKSkpIHtcclxuICAgICAgICAgICAgICAgICAgICBtYXNrZWRWYWx1ZSArPSB2YWx1ZUNoYXI7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMudmFsdWUgPSB0aGlzLnZhbHVlLnN1YnN0cmluZygwLCBpKSArIHRoaXMudmFsdWUuc3Vic3RyaW5nKGkgKyAxKTtcclxuICAgICAgICAgICAgICAgICAgICBpLS07XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAobWFza0NoYXIgIT09IHZhbHVlQ2hhciAmJiBtYXNrZWRWYWx1ZS5jaGFyQXQoaSArIGRpZikgIT09IG1hc2tDaGFyKSB7XHJcbiAgICAgICAgICAgICAgICBtYXNrZWRWYWx1ZSArPSBtYXNrQ2hhcjtcclxuICAgICAgICAgICAgICAgIGRpZisrO1xyXG4gICAgICAgICAgICAgICAgaS0tO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgbWFza2VkVmFsdWUgKz0gbWFza0NoYXI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5vbGRMZW5ndGggPSBtYXNrZWRWYWx1ZS5sZW5ndGg7XHJcbiAgICAgICAgaWYgKHRoaXMuX3Nob3dQbGFjZWhvbGRlcikge1xyXG4gICAgICAgICAgICBtYXNrZWRWYWx1ZSA9IHRoaXMuZmlsbFdpdGhQbGFjZWhvbGRlcihtYXNrZWRWYWx1ZSk7XHJcbiAgICAgICAgICAgIHRoaXMub2xkVmFsdWUgPSB0aGlzLmZpbGxXaXRoUGxhY2Vob2xkZXIodGhpcy5vbGRWYWx1ZSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLmNhcmV0UG9zID0gdGhpcy5nZXRVcGRhdGVkQ2FyZXRQb3MobWFza2VkVmFsdWUpO1xyXG4gICAgICAgIHRoaXMudmFsdWUgPSBtYXNrZWRWYWx1ZTtcclxuICAgICAgICB0aGlzLnVwZGF0ZUlucHV0KCk7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHVwZGF0ZUlucHV0KCkge1xyXG4gICAgICAgIHRoaXMuX2lucHV0Lm5hdGl2ZUVsZW1lbnQudmFsdWUgPSB0aGlzLnZhbHVlO1xyXG4gICAgICAgIHRoaXMuX2lucHV0Lm5hdGl2ZUVsZW1lbnQuc2VsZWN0aW9uU3RhcnQgPSB0aGlzLmNhcmV0UG9zO1xyXG4gICAgICAgIHRoaXMuX2lucHV0Lm5hdGl2ZUVsZW1lbnQuc2VsZWN0aW9uRW5kID0gdGhpcy5jYXJldFBvcztcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGdldFVwZGF0ZWRDYXJldFBvcyhtYXNrZWRWYWx1ZTogc3RyaW5nKSB7XHJcbiAgICAgICAgbGV0IGNhcmV0UG9zID0gdGhpcy5nZXRDYXJldFBvcygpO1xyXG4gICAgICAgIGlmIChjYXJldFBvcyA9PT0gdGhpcy5faW5wdXQubmF0aXZlRWxlbWVudC52YWx1ZS5sZW5ndGggfHwgY2FyZXRQb3MgPT09IHRoaXMub2xkTGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIGNhcmV0UG9zID0gdGhpcy5vbGRMZW5ndGg7XHJcbiAgICAgICAgfSBlbHNlIGlmICh0aGlzLm9sZFZhbHVlICE9PSBtYXNrZWRWYWx1ZSkge1xyXG4gICAgICAgICAgICB3aGlsZSAoY2FyZXRQb3MgPCB0aGlzLnZhbHVlLmxlbmd0aCAmJlxyXG4gICAgICAgICAgICB0aGlzLl9tYXNrLmNoYXJBdChjYXJldFBvcykgIT09IFwiOVwiICYmXHJcbiAgICAgICAgICAgIHRoaXMuX21hc2suY2hhckF0KGNhcmV0UG9zKSAhPT0gXCJBXCIpIHtcclxuICAgICAgICAgICAgICAgIGNhcmV0UG9zKys7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBjYXJldFBvcy0tO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gY2FyZXRQb3M7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBmaWxsV2l0aFBsYWNlaG9sZGVyKHZhbHVlOiBzdHJpbmcpOiBzdHJpbmcge1xyXG4gICAgICAgIGlmICghdmFsdWUpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHZhbHVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBsZXQgbWFzayA9IHRoaXMuX21hc2sucmVwbGFjZSgvWzlBXS9nLCB0aGlzLl9zbG90Q2hhcik7XHJcbiAgICAgICAgbWFzayA9IG1hc2suc3Vic3RyaW5nKHZhbHVlLmxlbmd0aCwgbWFzay5sZW5ndGgpO1xyXG4gICAgICAgIHZhbHVlID0gdmFsdWUgKyBtYXNrO1xyXG4gICAgICAgIHJldHVybiB2YWx1ZTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgZ2V0Q2FyZXRQb3MoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2lucHV0Lm5hdGl2ZUVsZW1lbnQuc2VsZWN0aW9uU3RhcnQ7XHJcbiAgICB9XHJcbn1cclxuIl19