/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
export class MaskingBase {
    constructor() {
        this._slotChar = "_";
        this._showPlaceholder = false;
        this._mask = "";
    }
    /**
     * @private
     * @param {?} s
     * @return {?}
     */
    static isNumeric(s) {
        if (s === " ") {
            return false;
        }
        return !isNaN(Number(s));
    }
    /**
     * @private
     * @param {?} s
     * @return {?}
     */
    static isAlpha(s) {
        return s.match(/^[a-z]+$/i) !== null;
    }
    /**
     * @return {?}
     */
    checkValue() {
        this.oldValue = this.value;
        this.value = this._input.nativeElement.value;
        if (!this.value) {
            return;
        }
        this.maskValue();
    }
    /**
     * @return {?}
     */
    maskValue() {
        /** @type {?} */
        let maskedValue = "";
        /** @type {?} */
        let dif = 0;
        /** @type {?} */
        let foundPlaceholder = false;
        for (let i = 0; i < this._mask.length && this.value.length !== i; i++) {
            /** @type {?} */
            const maskChar = this._mask.charAt(i + dif);
            /** @type {?} */
            const valueChar = this.value.charAt(i);
            if (this._showPlaceholder && valueChar === this._slotChar) {
                if (foundPlaceholder) {
                    break;
                }
                foundPlaceholder = true;
            }
            if (!MaskingBase.isAlpha(valueChar)
                && !MaskingBase.isNumeric(valueChar)
                && valueChar !== maskChar) {
                this.value = this.value.substring(0, i) + this.value.substring(i + 1);
                i--;
            }
            else if (maskChar === "9") {
                if (MaskingBase.isNumeric(valueChar)) {
                    maskedValue += valueChar;
                }
                else {
                    this.value = this.value.substring(0, i) + this.value.substring(i + 1);
                    i--;
                }
            }
            else if (maskChar === "A") {
                if (MaskingBase.isAlpha(this.value.charAt(i))) {
                    maskedValue += valueChar;
                }
                else {
                    this.value = this.value.substring(0, i) + this.value.substring(i + 1);
                    i--;
                }
            }
            else if (maskChar !== valueChar && maskedValue.charAt(i + dif) !== maskChar) {
                maskedValue += maskChar;
                dif++;
                i--;
            }
            else {
                maskedValue += maskChar;
            }
        }
        this.oldLength = maskedValue.length;
        if (this._showPlaceholder) {
            maskedValue = this.fillWithPlaceholder(maskedValue);
            this.oldValue = this.fillWithPlaceholder(this.oldValue);
        }
        this.caretPos = this.getUpdatedCaretPos(maskedValue);
        this.value = maskedValue;
        this.updateInput();
    }
    /**
     * @return {?}
     */
    updateInput() {
        this._input.nativeElement.value = this.value;
        this._input.nativeElement.selectionStart = this.caretPos;
        this._input.nativeElement.selectionEnd = this.caretPos;
    }
    /**
     * @private
     * @param {?} maskedValue
     * @return {?}
     */
    getUpdatedCaretPos(maskedValue) {
        /** @type {?} */
        let caretPos = this.getCaretPos();
        if (caretPos === this._input.nativeElement.value.length || caretPos === this.oldLength) {
            caretPos = this.oldLength;
        }
        else if (this.oldValue !== maskedValue) {
            while (caretPos < this.value.length &&
                this._mask.charAt(caretPos) !== "9" &&
                this._mask.charAt(caretPos) !== "A") {
                caretPos++;
            }
        }
        else {
            caretPos--;
        }
        return caretPos;
    }
    /**
     * @private
     * @param {?} value
     * @return {?}
     */
    fillWithPlaceholder(value) {
        if (!value) {
            return value;
        }
        /** @type {?} */
        let mask = this._mask.replace(/[9A]/g, this._slotChar);
        mask = mask.substring(value.length, mask.length);
        value = value + mask;
        return value;
    }
    /**
     * @return {?}
     */
    getCaretPos() {
        return this._input.nativeElement.selectionStart;
    }
}
if (false) {
    /**
     * @type {?}
     * @private
     */
    MaskingBase.prototype.oldLength;
    /** @type {?} */
    MaskingBase.prototype._slotChar;
    /** @type {?} */
    MaskingBase.prototype._showPlaceholder;
    /** @type {?} */
    MaskingBase.prototype._mask;
    /** @type {?} */
    MaskingBase.prototype._input;
    /**
     * @type {?}
     * @private
     */
    MaskingBase.prototype.oldValue;
    /**
     * @type {?}
     * @private
     */
    MaskingBase.prototype.caretPos;
    /** @type {?} */
    MaskingBase.prototype.value;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFza2luZy1iYXNlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQHVuY2FubnltaW5kcy9yYWNvb24tbWFzay1iYXNlLyIsInNvdXJjZXMiOlsibGliL21hc2tpbmctYmFzZS9tYXNraW5nLWJhc2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUVBLE1BQU0sT0FBTyxXQUFXO0lBQXhCO1FBR1csY0FBUyxHQUFHLEdBQUcsQ0FBQztRQUVoQixxQkFBZ0IsR0FBRyxLQUFLLENBQUM7UUFFekIsVUFBSyxHQUFHLEVBQUUsQ0FBQztJQXVIdEIsQ0FBQzs7Ozs7O0lBN0dXLE1BQU0sQ0FBQyxTQUFTLENBQUMsQ0FBUztRQUM5QixJQUFJLENBQUMsS0FBSyxHQUFHLEVBQUU7WUFDWCxPQUFPLEtBQUssQ0FBQztTQUNoQjtRQUNELE9BQU8sQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDN0IsQ0FBQzs7Ozs7O0lBRU8sTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFTO1FBQzVCLE9BQU8sQ0FBQyxDQUFDLEtBQUssQ0FBQyxXQUFXLENBQUMsS0FBSyxJQUFJLENBQUM7SUFDekMsQ0FBQzs7OztJQUdNLFVBQVU7UUFDYixJQUFJLENBQUMsUUFBUSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUM7UUFDM0IsSUFBSSxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLGFBQWEsQ0FBQyxLQUFLLENBQUM7UUFDN0MsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLEVBQUU7WUFDYixPQUFPO1NBQ1Y7UUFDRCxJQUFJLENBQUMsU0FBUyxFQUFFLENBQUM7SUFDckIsQ0FBQzs7OztJQUdNLFNBQVM7O1lBQ1IsV0FBVyxHQUFHLEVBQUU7O1lBQ2hCLEdBQUcsR0FBRyxDQUFDOztZQUNQLGdCQUFnQixHQUFHLEtBQUs7UUFFNUIsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLElBQUksQ0FBQyxLQUFLLENB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QyxNQUFNLEVBQUUsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQ2pELEtBQUssR0FBRyxLQUFLLEdBQUcsSUFBSSxDQUFDO1FBQ3JCLE9BQU8sS0FBSyxDQUFDO0lBQ2pCLENBQUM7Ozs7SUFFTSxXQUFXO1FBQ2QsT0FBTyxJQUFJLENBQUMsTUFBTSxDQUFDLGFBQWEsQ0FBQyxjQUFjLENBQUM7SUFDcEQsQ0FBQztDQUNKOzs7Ozs7SUE3SEcsZ0NBQTBCOztJQUUxQixnQ0FBdUI7O0lBRXZCLHVDQUFnQzs7SUFFaEMsNEJBQWtCOztJQUVsQiw2QkFBMEI7Ozs7O0lBRTFCLCtCQUF5Qjs7Ozs7SUFFekIsK0JBQXlCOztJQUV6Qiw0QkFBcUIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBFbGVtZW50UmVmIH0gZnJvbSBcIkBhbmd1bGFyL2NvcmVcIjtcclxuXHJcbmV4cG9ydCBjbGFzcyBNYXNraW5nQmFzZSB7XHJcbiAgICBwcml2YXRlIG9sZExlbmd0aDogbnVtYmVyO1xyXG5cclxuICAgIHB1YmxpYyBfc2xvdENoYXIgPSBcIl9cIjtcclxuXHJcbiAgICBwdWJsaWMgX3Nob3dQbGFjZWhvbGRlciA9IGZhbHNlO1xyXG5cclxuICAgIHB1YmxpYyBfbWFzayA9IFwiXCI7XHJcblxyXG4gICAgcHVibGljIF9pbnB1dDogRWxlbWVudFJlZjtcclxuXHJcbiAgICBwcml2YXRlIG9sZFZhbHVlOiBzdHJpbmc7XHJcblxyXG4gICAgcHJpdmF0ZSBjYXJldFBvczogbnVtYmVyO1xyXG5cclxuICAgIHB1YmxpYyB2YWx1ZTogc3RyaW5nO1xyXG5cclxuICAgIHByaXZhdGUgc3RhdGljIGlzTnVtZXJpYyhzOiBzdHJpbmcpIHtcclxuICAgICAgICBpZiAocyA9PT0gXCIgXCIpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gIWlzTmFOKE51bWJlcihzKSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBzdGF0aWMgaXNBbHBoYShzOiBzdHJpbmcpIHtcclxuICAgICAgICByZXR1cm4gcy5tYXRjaCgvXlthLXpdKyQvaSkgIT09IG51bGw7XHJcbiAgICB9XHJcblxyXG5cclxuICAgIHB1YmxpYyBjaGVja1ZhbHVlKCkge1xyXG4gICAgICAgIHRoaXMub2xkVmFsdWUgPSB0aGlzLnZhbHVlO1xyXG4gICAgICAgIHRoaXMudmFsdWUgPSB0aGlzLl9pbnB1dC5uYXRpdmVFbGVtZW50LnZhbHVlO1xyXG4gICAgICAgIGlmICghdGhpcy52YWx1ZSkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMubWFza1ZhbHVlKCk7XHJcbiAgICB9XHJcblxyXG5cclxuICAgIHB1YmxpYyBtYXNrVmFsdWUoKSB7XHJcbiAgICAgICAgbGV0IG1hc2tlZFZhbHVlID0gXCJcIjtcclxuICAgICAgICBsZXQgZGlmID0gMDtcclxuICAgICAgICBsZXQgZm91bmRQbGFjZWhvbGRlciA9IGZhbHNlO1xyXG5cclxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuX21hc2subGVuZ3RoICYmIHRoaXMudmFsdWUubGVuZ3RoICE9PSBpOyBpKyspIHtcclxuICAgICAgICAgICAgY29uc3QgbWFza0NoYXIgPSB0aGlzLl9tYXNrLmNoYXJBdChpICsgZGlmKTtcclxuICAgICAgICAgICAgY29uc3QgdmFsdWVDaGFyID0gdGhpcy52YWx1ZS5jaGFyQXQoaSk7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLl9zaG93UGxhY2Vob2xkZXIgJiYgdmFsdWVDaGFyID09PSB0aGlzLl9zbG90Q2hhcikge1xyXG4gICAgICAgICAgICAgICAgaWYgKGZvdW5kUGxhY2Vob2xkZXIpIHtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGZvdW5kUGxhY2Vob2xkZXIgPSB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICghTWFza2luZ0Jhc2UuaXNBbHBoYSh2YWx1ZUNoYXIpXHJcbiAgICAgICAgICAgICAgICAmJiAhTWFza2luZ0Jhc2UuaXNOdW1lcmljKHZhbHVlQ2hhcilcclxuICAgICAgICAgICAgICAgICYmIHZhbHVlQ2hhciAhPT0gbWFza0NoYXIpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMudmFsdWUgPSB0aGlzLnZhbHVlLnN1YnN0cmluZygwLCBpKSArIHRoaXMudmFsdWUuc3Vic3RyaW5nKGkgKyAxKTtcclxuICAgICAgICAgICAgICAgIGktLTtcclxuICAgICAgICAgICAgfSBlbHNlIGlmIChtYXNrQ2hhciA9PT0gXCI5XCIpIHtcclxuICAgICAgICAgICAgICAgIGlmIChNYXNraW5nQmFzZS5pc051bWVyaWModmFsdWVDaGFyKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIG1hc2tlZFZhbHVlICs9IHZhbHVlQ2hhcjtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy52YWx1ZSA9IHRoaXMudmFsdWUuc3Vic3RyaW5nKDAsIGkpICsgdGhpcy52YWx1ZS5zdWJzdHJpbmcoaSArIDEpO1xyXG4gICAgICAgICAgICAgICAgICAgIGktLTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSBlbHNlIGlmIChtYXNrQ2hhciA9PT0gXCJBXCIpIHtcclxuICAgICAgICAgICAgICAgIGlmIChNYXNraW5nQmFzZS5pc0FscGhhKHRoaXMudmFsdWUuY2hhckF0KGkpKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIG1hc2tlZFZhbHVlICs9IHZhbHVlQ2hhcjtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy52YWx1ZSA9IHRoaXMudmFsdWUuc3Vic3RyaW5nKDAsIGkpICsgdGhpcy52YWx1ZS5zdWJzdHJpbmcoaSArIDEpO1xyXG4gICAgICAgICAgICAgICAgICAgIGktLTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSBlbHNlIGlmIChtYXNrQ2hhciAhPT0gdmFsdWVDaGFyICYmIG1hc2tlZFZhbHVlLmNoYXJBdChpICsgZGlmKSAhPT0gbWFza0NoYXIpIHtcclxuICAgICAgICAgICAgICAgIG1hc2tlZFZhbHVlICs9IG1hc2tDaGFyO1xyXG4gICAgICAgICAgICAgICAgZGlmKys7XHJcbiAgICAgICAgICAgICAgICBpLS07XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBtYXNrZWRWYWx1ZSArPSBtYXNrQ2hhcjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLm9sZExlbmd0aCA9IG1hc2tlZFZhbHVlLmxlbmd0aDtcclxuICAgICAgICBpZiAodGhpcy5fc2hvd1BsYWNlaG9sZGVyKSB7XHJcbiAgICAgICAgICAgIG1hc2tlZFZhbHVlID0gdGhpcy5maWxsV2l0aFBsYWNlaG9sZGVyKG1hc2tlZFZhbHVlKTtcclxuICAgICAgICAgICAgdGhpcy5vbGRWYWx1ZSA9IHRoaXMuZmlsbFdpdGhQbGFjZWhvbGRlcih0aGlzLm9sZFZhbHVlKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuY2FyZXRQb3MgPSB0aGlzLmdldFVwZGF0ZWRDYXJldFBvcyhtYXNrZWRWYWx1ZSk7XHJcbiAgICAgICAgdGhpcy52YWx1ZSA9IG1hc2tlZFZhbHVlO1xyXG4gICAgICAgIHRoaXMudXBkYXRlSW5wdXQoKTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgdXBkYXRlSW5wdXQoKSB7XHJcbiAgICAgICAgdGhpcy5faW5wdXQubmF0aXZlRWxlbWVudC52YWx1ZSA9IHRoaXMudmFsdWU7XHJcbiAgICAgICAgdGhpcy5faW5wdXQubmF0aXZlRWxlbWVudC5zZWxlY3Rpb25TdGFydCA9IHRoaXMuY2FyZXRQb3M7XHJcbiAgICAgICAgdGhpcy5faW5wdXQubmF0aXZlRWxlbWVudC5zZWxlY3Rpb25FbmQgPSB0aGlzLmNhcmV0UG9zO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZ2V0VXBkYXRlZENhcmV0UG9zKG1hc2tlZFZhbHVlOiBzdHJpbmcpIHtcclxuICAgICAgICBsZXQgY2FyZXRQb3MgPSB0aGlzLmdldENhcmV0UG9zKCk7XHJcbiAgICAgICAgaWYgKGNhcmV0UG9zID09PSB0aGlzLl9pbnB1dC5uYXRpdmVFbGVtZW50LnZhbHVlLmxlbmd0aCB8fCBjYXJldFBvcyA9PT0gdGhpcy5vbGRMZW5ndGgpIHtcclxuICAgICAgICAgICAgY2FyZXRQb3MgPSB0aGlzLm9sZExlbmd0aDtcclxuICAgICAgICB9IGVsc2UgaWYgKHRoaXMub2xkVmFsdWUgIT09IG1hc2tlZFZhbHVlKSB7XHJcbiAgICAgICAgICAgIHdoaWxlIChjYXJldFBvcyA8IHRoaXMudmFsdWUubGVuZ3RoICYmXHJcbiAgICAgICAgICAgIHRoaXMuX21hc2suY2hhckF0KGNhcmV0UG9zKSAhPT0gXCI5XCIgJiZcclxuICAgICAgICAgICAgdGhpcy5fbWFzay5jaGFyQXQoY2FyZXRQb3MpICE9PSBcIkFcIikge1xyXG4gICAgICAgICAgICAgICAgY2FyZXRQb3MrKztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGNhcmV0UG9zLS07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBjYXJldFBvcztcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGZpbGxXaXRoUGxhY2Vob2xkZXIodmFsdWU6IHN0cmluZyk6IHN0cmluZyB7XHJcbiAgICAgICAgaWYgKCF2YWx1ZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gdmFsdWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGxldCBtYXNrID0gdGhpcy5fbWFzay5yZXBsYWNlKC9bOUFdL2csIHRoaXMuX3Nsb3RDaGFyKTtcclxuICAgICAgICBtYXNrID0gbWFzay5zdWJzdHJpbmcodmFsdWUubGVuZ3RoLCBtYXNrLmxlbmd0aCk7XHJcbiAgICAgICAgdmFsdWUgPSB2YWx1ZSArIG1hc2s7XHJcbiAgICAgICAgcmV0dXJuIHZhbHVlO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBnZXRDYXJldFBvcygpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5faW5wdXQubmF0aXZlRWxlbWVudC5zZWxlY3Rpb25TdGFydDtcclxuICAgIH1cclxufVxyXG4iXX0=